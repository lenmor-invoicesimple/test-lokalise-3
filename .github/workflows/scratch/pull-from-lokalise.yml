name: Pull from Lokalise

on:
  workflow_dispatch:  # Manual trigger
  schedule:
    - cron: '0 9 * * 1'  # Weekly on Monday at 9 AM UTC (optional)

jobs:
  pull-translations:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # - name: Trigger Machine Translation
      #   run: |
      #     # Trigger auto-translation for all target languages
      #     curl -X POST \
      #       "https://api.lokalise.com/api2/projects/${{ secrets.LOKALISE_PROJECT_ID }}/keys/bulk_update" \
      #       -H "X-Api-Token: ${{ secrets.LOKALISE_API_TOKEN }}" \
      #       -H "Content-Type: application/json" \
      #       -d '{
      #         "keys": [],
      #         "use_automations": true
      #       }'
          
      #     # Wait a bit for translations to complete
      #     sleep 30

      - name: Pull from Lokalise
        uses: lokalise/lokalise-pull-action@v3.9.0
        with:
          api_token: ${{ secrets.LOKALISE_API_TOKEN }}
          project_id: ${{ secrets.LOKALISE_PROJECT_ID }}   # Replace with your actual project ID
          translations_path: src/locales
          base_lang: en
          file_format: json
          flat_naming: true
          always_pull_base: false  # Set to true if you want to pull base language changes too
          skip_include_tags: true  # Skip automatic tag filtering by branch name
          additional_params: "--indentation=4sp"  # Match your current JSON formatting
          # PR customization options:
          # temp_branch_prefix: "translations"  # Creates branches like "translations-some-updates-123"
          # pr_title: "üåç Update translations from Lokalise"
          # pr_body: |
          #   This PR contains updated translations from Lokalise.
            
          #   Please review the changes and merge when ready.
            
          #   Updated languages: All configured target languages
          # pr_labels: "translations,automated"  # Add labels to the PR
